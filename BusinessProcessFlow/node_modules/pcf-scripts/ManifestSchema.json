{
    "definitions": {
        "manifest": {
            "type": "object",
            "properties": {
                "control": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/control" },
                    "maxItems": 1
                }
            },
            "required": ["control"],
            "additionalProperties": false
        },
        
        "control": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/controlAttribs" },
                "type-group": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/type-group" }
                },
                "property": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/property" }
                },
                "data-set": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/dataSet" }
                },
                "resources": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/resource" },
                    "maxItems": 1
                },
                "feature-usage": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/featureUsage" },
                    "maxItems": 1
                }
            },
            "required": ["$", "resources"],
            "additionalProperties": false
        },

        "controlAttribs": {
            "type": "object",
            "properties": {
                "namespace": {
                    "type": "string",
                    "pattern": "^(?!\\.|\\d)(?!.*\\.$)(?!.*?\\.\\d)(?!.*?\\.\\.)[a-zA-Z0-9.]+$"
                },
                "constructor": {
                    "type": "string",
                    "pattern": "^(?!\\d)[a-zA-Z0-9]+$"
                },
                "version": { "$ref": "#/definitions/versionType" },
                "display-name-key": { "type": "string" },
                "description-key": { "type": "string" },
                "control-type": {
                    "type": "string",
                    "enum": ["standard", "virtual" ]
                },
                "preview-image": { "type": "string" },
                "api-version": { "type": "string" },
                "design-mapping-file": { "type": "string" },
                "authoring-manifest": { "type": "string" }
            },
            "required": ["namespace", "constructor", "version", "display-name-key"],
            "additionalProperties": false
        },

        "property": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/propertyAttribs" },
                "value": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/enum" }
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },
        
        "propertyAttribs": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "usage": { "$ref": "#/definitions/usageType" },
                "required": { "$ref": "#/definitions/booleanType" },
                "of-type" : { "$ref": "#/definitions/dataType" },
                "of-type-group": { "type": "string" },
                "display-name-key": { "type": "string" },
                "description-key": { "type": "string" },
                "default-value": { "type": "string" }
            },
            "required": ["name", "display-name-key"],
            "additionalProperties": false
        },

        "enum": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/enumAttribs" },
                "_": { "type": "string" }
            },
            "required": ["$", "_"],
            "additionalProperties": false
        },

        "enumAttribs": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "display-name-key": { "type": "string" },
                "description-key": { "type": "string" },
                "default": { "type": "string" }
            },
            "required": ["name", "display-name-key"],
            "additionalProperties": false
        },

        "propertySet": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/propertySetAttribs" }
            },
            "required": ["$"],
            "additionalProperties": false
        },
        
        "propertySetAttribs": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "usage": { "$ref": "#/definitions/usageType" },
                "required": { "$ref": "#/definitions/booleanType" },
                "of-type" : { "$ref": "#/definitions/dataType" },
                "of-type-group": { "type": "string" },
                "display-name-key": { "type": "string" },
                "description-key": { "type": "string" }
            },
            "required": ["name", "usage", "display-name-key"],
            "additionalProperties": false
        },

        "dataSet": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/dataSetAttribs" },
                "property-set": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/propertySet" }
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },
        
        "dataSetAttribs": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "display-name-key": { "type": "string" },
                "description-key": { "type": "string" },
                "cds-data-set-options": { "type": "string" }
            },
            "required": ["name", "display-name-key"],
            "additionalProperties": false
        },

        "featureUsage": {
            "type": "object",
            "properties": {
                "uses-feature": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/usesFeature" }
                }
            },
            "required": ["uses-feature"],
            "additionalProperties": false
        },

        "usesFeature": {
            "type": "object",
            "properties": {
                "$": { "$ref": "#/definitions/usesFeatureAttribs" }
            },
            "required": ["$"],
            "additionalProperties": false
        },
        
        "usesFeatureAttribs": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "type": { "$ref": "#/definitions/usesFeatureType" },
                "required": { "$ref": "#/definitions/booleanType" }
            },
            "required": ["name", "required"],
            "additionalProperties": false
        },

        "type-group": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "name": { "type": "string" }
                    },
                    "required": ["name"],
                    "additionalProperties": false
                },
                "type": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/dataType" }
                }
            },
            "required": ["$", "type"],
            "additionalProperties": false
        },

        "resource": {
            "type": "object",
            "properties": {
                "code": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/code" },
                    "maxItems": 1
                },
                "css": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/css" }
                },
                "resx": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/resx" }
                },
                "img": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/img" }
                },
                "html": {
                    "type": "array",
                    "items": { "$ref": "#/definitions/html" }
                }
            },
            "required": ["code"],
            "additionalProperties": false
        },
        
        "code": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "type": "string", "pattern": "^.+\\.ts$", "minLength": 1 },
                        "order": { "$ref": "#/definitions/orderType" }
                    },
                    "required": ["path", "order"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "css": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "$ref": "#/definitions/pathType" },
                        "order": { "$ref": "#/definitions/orderType" }
                    },
                    "required": ["path"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "img": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "$ref": "#/definitions/pathType" }
                    },
                    "required": ["path"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "html": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "$ref": "#/definitions/pathType" },
                        "order": { "$ref": "#/definitions/orderType" }
                    },
                    "required": ["path"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "resx": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "$ref": "#/definitions/pathType" },
                        "version": { "$ref": "#/definitions/versionType" }
                    },
                    "required": ["path", "version"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "packagedLibrary": {
            "type": "object",
            "properties": {
                "$": {
                    "type": "object",
                    "properties": {
                        "path": { "$ref": "#/definitions/pathType" },
                        "version": { "$ref": "#/definitions/versionType" }
                    },
                    "required": ["path", "version"],
                    "additionalProperties": false
                }
            },
            "required": ["$"],
            "additionalProperties": false
        },

        "orderType": {
            "type": "string",
            "pattern": "^[1-9]\\d*$"
        },
        "versionType": {
            "type": "string",
            "pattern": "^\\d+(\\.\\d+)*$"
        },
        "pathType": { 
            "type": "string",
            "minLength": 1
        },
        "booleanType": {
            "type": "string",
            "enum": ["true", "false"]
        },
        "usageType": {
            "type": "string",
            "enum": ["bound", "input", "output"]
        },
        "usesFeatureType": {
            "type": "string",
            "enum": ["api"]
        },
        "dataType": {
            "type": "string",
            "enum": [
                "Whole.None",
                "TwoOptions",
                "DateAndTime.DateOnly",
                "DateAndTime.DateAndTime",
                "Decimal",
                "Enum",
                "FP",
                "Multiple",
                "Currency",
                "OptionSet",
                "SingleLine.Email",
                "SingleLine.Text",
                "SingleLine.TextArea",
                "SingleLine.URL",
                "SingleLine.Ticker",
                "SingleLine.Phone"
            ]
        }
    },

    "type": "object",
    "properties": {
        "manifest": { "$ref": "#/definitions/manifest" }
    },
    "required": ["manifest"]
}